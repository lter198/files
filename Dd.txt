<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %>

<html>
<head><title>問題登録</title></head>
<body>
<h2>問題登録</h2>

<html:form action="/questionRegister">
    問題ID: <html:text property="id"/><br/>
    内容: <html:text property="content" maxlength="30"/><br/>
    <html:submit value="登録"/>
</html:form>

</body>
</html>


package jp.co.starts_cs.brs.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;

import jp.co.starts_cs.brs.dto.QuestionDto;

public class QuestionDao {

    public void insert(Connection conn, QuestionDto dto) throws Exception {
        String sql = "INSERT INTO question_input (id, content) VALUES (?, ?)";
        try (PreparedStatement ps = conn.prepareStatement(sql)) {
            ps.setInt(1, dto.getId());
            ps.setString(2, dto.getContent());
            ps.executeUpdate();
        }
    }
}



package jp.co.starts_cs.brs.service;

import java.sql.Connection;
import java.sql.DriverManager;

import jp.co.starts_cs.brs.dao.QuestionDao;
import jp.co.starts_cs.brs.dto.QuestionDto;

public class QuestionService {

    public void registerQuestion(QuestionDto dto) throws Exception {
        // 连接DB（可抽取到共通类）
        try (Connection conn = DriverManager.getConnection(
                "jdbc:sqlserver://localhost:1433;databaseName=QuestionDB",
                "sa", "your_password")) {

            QuestionDao dao = new QuestionDao();
            dao.insert(conn, dto);
        }
    }
}


package jp.co.starts_cs.brs.action;

import javax.servlet.http.*;
import org.apache.struts.action.*;

import jp.co.starts_cs.brs.form.QuestionForm;
import jp.co.starts_cs.brs.dto.QuestionDto;
import jp.co.starts_cs.brs.service.QuestionService;

public class QuestionAction extends Action {

    public ActionForward execute(ActionMapping mapping, ActionForm form,
                                 HttpServletRequest request, HttpServletResponse response) throws Exception {
        QuestionForm qForm = (QuestionForm) form;

        QuestionDto dto = new QuestionDto();
        dto.setId(Integer.parseInt(qForm.getId()));
        dto.setContent(qForm.getContent());

        QuestionService service = new QuestionService();
        service.registerQuestion(dto);

        request.setAttribute("message", "登録完了！");
        return mapping.findForward("success");
    }
}


package jp.co.starts_cs.brs.form;

import org.apache.struts.action.ActionForm;

public class QuestionForm extends ActionForm {
    private String id;
    private String content;

    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
}